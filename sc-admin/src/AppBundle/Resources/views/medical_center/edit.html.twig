{% extends '@App/base.html.twig' %}

{% block ol %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{{ path('homepage') }}">Home</a>
        </li>
        <li class="breadcrumb-item active">
            <a href="{{ path('medical_center_list') }}">Medical Center</a>
        </li>
        <li class="breadcrumb-item active">Update</li>
        <!-- Breadcrumb Menu-->
        <li class="breadcrumb-menu d-md-down-none">
            {#<div class="btn-group" role="group" aria-label="Button group">
                <a class="btn" href="#">
                    <i class="icon-speech"></i>
                </a>
                <a class="btn" href="./">
                    <i class="icon-graph"></i>  Dashboard</a>
                <a class="btn" href="#">
                    <i class="icon-settings"></i>  Settings</a>
            </div>#}
        </li>
    </ol>        
{% endblock %}


{% block body %}
    {% set globalCurrentSymbol = "" %}        
    <div class="card">
        <div class="card-header">
            <strong>Update Medical Center</strong>
            {#            <small>List</small>#}
        </div>
        <div class="card-body">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#medicalCenter" role="tab" aria-controls="medicalCenter" onclick="">Medical Center</a>
                </li>        
                <li class="nav-item">
                    <a id="hlicense" class="nav-link " data-toggle="tab" href="#licenseLi" role="tab" aria-controls="licenseLi" onclick="setTimeout('next()', 0500);">Licenses / Payments</a>
                </li>
            </ul>
            <form action="" method="post" id="formid" enctype="multipart/form-data">  
                <input name="inputMedicalCenterId" id="inputMedicalCenterId" type="hidden" value="{{ medicalcenter.id }}">
                <div class="tab-content">
                    <div class="tab-pane in active" id="medicalCenter" role="tabpanel">   
                        <div class="row">
                            <div class="form-group col-sm-6">  
                                <label>Country</label>
                                <div class="selector-exam">
                                    <input name="timeZ" id="timeZ" type="hidden" value="">
                                    <select class="form-control select-country" style="width: 100%" name="country" id="country" onchange="loadAjax('country', 'div-province', 1);
                                            loadAjax('country', 'divWayToPay', 5);
                                            loadAjax('country', 'divIssuingBank', 6);
                                            loadAjax('country', 'divReceivingBank', 7);
                                            loadAjax2('country', 'div-licenses', 3);">
                                        <option value="">Select...</option>  
                                        {% for countries in countries %}
                                            {% if countries.id == medicalcenter.countryid %}
                                                {% set selected = 'selected' %}
                                                <option value="{{countries.id}}" {{ selected }}>{{countries.name}}</option>
                                                {% set globalCurrentSymbol = countries.currencySymbol %}        
                                            {% else %}   
                                                <option value="{{countries.id}}">{{countries.name}}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group col-sm-6">   
                                <label>Province</label>
                                <div id="div-province">
                                    <select class="form-control select-province" style="width: 100%" name="province" id="province">
                                        <option value="">Select...</option>                                                    
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-sm-6">  
                                <label>Name</label>
                                <input name="name" id="name" type="text" value="{{ medicalcenter.name }}" placeholder="Name" class="form-control">
                            </div>
                            <div class="form-group col-sm-6">  
                                <label>Code</label>
                                <input name="code" id="code" type="text" value="{{ medicalcenter.code }}" placeholder="Code" class="form-control">
                            </div>
                        </div>
                        {#<div class="row">
                            <div class="form-group col-sm-6">  
                                <label>Type</label>
                                <div class="selector-exam">
                                    <select class="form-control select-type" style="width: 100%" name="typemedicalcenter" id="typemedicalcenter">
                                        <option value="">Select...</option>  
                                        {% for ArrayTypeMedicalCenter in ArrayTypeMedicalCenter %}
                                            {% if loop.index-1 == medicalcenter.type %}
                                                {% set selected = 'selected' %}
                                                <option value="{{loop.index-1}}" {{ selected }}>{{ArrayTypeMedicalCenter}}</option>
                                            {% else %}
                                                <option value="{{loop.index-1}}">{{ArrayTypeMedicalCenter}}</option>    
                                            {% endif %}    
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>                
                            <div class="form-group col-sm-6">     
                                <label>Address</label>
                                <textarea name="address" id="address" type="text" class="form-control">{{ medicalcenter.address }}</textarea>
                            </div>
                        </div>#}
                        <div class="row">
                            {#<div class="form-group col-sm-6">  
                                <label>Phone</label>
                                <input name="phone" id="phone" type="text" value="{{ medicalcenter.phone|join(',') }}" placeholder="Phone" class="form-control" data-role="tagsinput" >                    
                            </div>#}
                            {% set emailMc =  "" %}       
                            {% for email in  medicalcenter.master %}
                                {% set emailMc =  email.email %}                      
                            {% endfor %}
                            <div class="form-group col-sm-6">  
                                <label>Master</label>
                                <input name="master" id="master" type="text" value="{{ emailMc }}" placeholder="Email" onchange="verificarEmail(this.value);" class="form-control" onchange="validateEmail(this.value);">                    
                                <input name="master_" id="master_" type="hidden" value="{{ emailMc }}" class="form-control">                    
                            </div>                
                        </div>                
                        {# <div class="row">
                             <div class="form-group col-sm-6">  
                                 <label>Contac 1</label>
                                 <input name="contac1" id="contac1" type="text" value="{{ medicalcenter.contac1 }}" placeholder="Contac 1" class="form-control">                    
                             </div>
                             <div class="form-group col-sm-6">  
                                 <label>Telephone contact 1</label>
                                 <input name="telephonecontact1" id="telephonecontact1" type="text" value="{{ medicalcenter.contac1phone|join(',') }}" placeholder="Telephone contact 1" class="form-control" data-role="tagsinput" >                    
                             </div>
                         </div>#}
                        <div class="form-group">      
                            <input type="button" value="Next" class="btn btn-primary" id="buttonnext" onclick="setTimeout('next()', 0500);" style="">&nbsp;&nbsp;&nbsp;                    
                            <a class="btn btn-primary" style="color: #ffffff" href="{{ path('medical_center_details', { 'id': medicalcenter.id }) }}">Return</a>
                        </div>
                    </div>
                    {#////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////#}   
                    <div class="tab-pane" id="licenseLi" role="tabpanel">
                        <div class="form-group">       
                            <label>Licenses</label>
                            <div id="div-licenses">
                                <select class="form-control select-licenses" style="width: 100%" name="license" id="license" onchange="loadAjax('license', 'divLicenses', 4);
                                        loadInfoLicense();">
                                    <option value="">Select...</option>                                                    
                                </select>
                            </div>
                        </div>               
                        <div class="form-group" style="width: 100%; overflow: auto;">    
                            <br>
                            <div align="center" id="labelLicense" style="display: block"><h4 style="background-color: #f0f3f5; align-items: center">Licenses</h4></div>
                            <input name="countLicenses" id="countLicenses" type="hidden" value="{{countLicensesMc}}">
                            <table id="tablelicenses" class="table table-responsive-sm table-bordered table-hover table-sm" style="display: table; width: 100%; font-size: 14px;">
                                <tr align="center" style="background-color: #f0f3f5;">
                                    <th align="center">License</th>                            
                                    <th align="center">Users Quantity</th>                            
                                    <th align="center">Number of Clients</th>                            
                                    <th align="center">Number of Exams</th>                            
                                    <th align="center">Duration Time</th>                            
                                    <th align="center">Amount</th>   
                                    <th align="center">Action</th>
                                </tr>
                                {% set acumAmount = 0 %}      
                                {% for licensesMC in medicalcenter.licenses %}
                                    {% set license = '' %}   
                                    {% set usersquantity = '' %}   
                                    {% set numberclients = '' %}                   
                                    {% set numberexams = '' %}                   
                                    {% set durationtime = '' %}         
                                    {% set amount = '' %}         
                                    {% set statusRegister = '' %}         

                                    {% for licenses in licenses %}
                                        {% if licensesMC.license_id == licenses.id %}
                                            {% set license = licenses.license %}   
                                            {% set usersquantity = licenses.usersquantity %}   
                                            {% set numberclients = licenses.numberclients %}                   
                                            {% set numberexams = licenses.numberexams %}                   
                                            {% set durationtime = licenses.durationtime %}         
                                            {% set amount = licenses.amount %}  
                                            {% if licensesMC.status == "Active" %}
                                                {% set acumAmount = acumAmount + amount %} 
                                            {% endif %}        
                                        {% endif %}
                                    {% endfor %}
                                    {% if licensesMC.status == "Active" %}
                                        {% set statusRegister = '1' %}         
                                        <tr align="center" id="trlicense_{{ loop.index-1 }}">
                                        {% else %}
                                            {% set statusRegister = '2' %}         
                                        <tr align="center" id="trlicense_{{ loop.index-1 }}" style="display: none">
                                        {% endif %}        
                                        <td align="center">{{ license }}
                                            <input type="hidden" id="licenseId_{{loop.index-1}}" name="licenseId_{{loop.index-1}}"  value="{{licensesMC.license_id}}" />
                                            <input type="hidden" id="durationTime_{{loop.index-1}}" name="durationTime_{{loop.index-1}}"  value="{{durationtime}}" />
                                            <input type="hidden" id="statusRegisterLicense_{{loop.index-1}}" name="statusRegisterLicense_{{loop.index-1}}"  value="{{statusRegister}}" />
                                        </td>                            
                                        <td align="center">{{ usersquantity }}</td>                            
                                        <td align="center">{{ numberclients }}</td>                            
                                        <td align="center">{{ numberexams }}</td>                            
                                        <td align="center">{{ durationtime }}</td>                            
                                        <td align="center">{{ amount|number_format(2, '.', ',') }} {{ globalCurrentSymbol }}</td>                            
                                        <td align="center"><a title="Delete" id="" onclick="loadDeleteModalEdit('trlicense_', '{{ loop.index-1 }}', '{{ amount }}', '{{ medicalcenter.id }}', 1);" class="" style=""><img src="{{ asset('img/delete.png') }}" alt="Delete" width="18px" height="18px"/></a></td>                            

                                    </tr>                            
                                {% endfor %}
                            </table>

                        </div>
                        <div class="row" id="divAmount">
                            <div class="form-group col-sm-6"></div>
                            <div class="form-group col-sm-6">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><b>Total to pay:</b></span>
                                    </div>
                                    <input readonly="" name="amountTotal" id="amountTotal" type="hidden" value="{{ acumAmount  }}" >
                                    <input type="text" name="amountTotalShow" id="amountTotalShow" class="form-control" value="{{ acumAmount|number_format(2, '.', ',')  }}">
                                    <div class="input-group-append">
                                        <span class="input-group-text" id="labelCurrent">{{ globalCurrentSymbol }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>   
                        <div align="center" id="labelPayments" style="display: block"><h4 style="background-color: #f0f3f5; align-items: center">Licenses</h4></div>
                        <div id="payment" style="display: block">
                            <div class="row">
                                <div class="form-group col-sm-6">    
                                    <label>Way to pay</label>
                                    <div id="divWayToPay">
                                        <select class="form-control select-waytopay" style="width: 100%" name="waytopay" id="waytopay" onchange="wayToPayOperation();">
                                            <option value="">Select...</option>                                  
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-sm-6">         
                                    <label>Payment type</label>
                                    <div id="divWayToPay">
                                        <select class="form-control select-paymenttype" style="width: 100%" name="paymenttype" id="paymenttype" onchange="paymentType();">
                                            <option value="">Select...</option>                                  
                                            <option value="full">Full</option>                                  
                                            <option value="partial">Partial</option>                                  
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6" id="divDaystopay" style="display: none">       
                                    <label id="labelDaystopay">Days to pay</label>
                                    <input name="daystopay" id="daystopay" type="text" value="0" placeholder="Days to pay" class="form-control" onkeypress="">                    
                                </div>
                                <div class="form-group col-sm-6">    
                                    <label>Amount</label>
                                    <input name="amount" id="amount" type="text" value="" placeholder="Amount" class="form-control" onkeypress="">                    
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6">      
                                    <label>Issuing bank</label>
                                    <div id="divIssuingBank">
                                        <select class="form-control select-issuingbank" style="width: 100%" name="issuingbank" id="issuingbank" onchange="">
                                            <option value="">Select...</option>                                  
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-sm-6">     
                                    <label>Receiving bank</label>
                                    <div id="divReceivingBank">
                                        <select class="form-control select-receivingbank" style="width: 100%" name="receivingbank" id="receivingbank" onchange="">
                                            <option value="">Select...</option>                                  
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div id="divInfoTarjetas" style="display: none">
                                <div class="row">
                                    <div class="form-group col-sm-6">    
                                        <label>Card holder</label>
                                        <input name="cardholder" id="cardholder" type="text" value="" placeholder="Cardholder" class="form-control">    
                                    </div>
                                    <div class="form-group col-sm-6">    
                                        <label>Card number</label>
                                        <input name="cardnumber" id="cardnumber" type="text" value="" placeholder="Card number" class="form-control">    
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-sm-6">    
                                        <label>Expiration</label>
                                        <input name="expiration" id="expiration" type="text" value="" placeholder="Expiration" class="form-control">    
                                    </div>
                                    <div class="form-group col-sm-6">    
                                        <label>CVV</label>
                                        <input name="cvv" id="cvv" type="text" value="" placeholder="CVV" class="form-control">    
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6" id="divNumCheck" style="display: none">
                                    <label>Check number</label>
                                    <input name="operationnumber" id="operationnumber" type="text" value="" placeholder="Check Number" class="form-control" disabled="">                    
                                </div>
                                <div class="form-group col-sm-6" id="divProofTransfer"  style="display: none">
                                    <label>Proof transfer</label>
                                    <input type="file" id="files4" name="files4" onchange="base64File4(this);"/>
                                    <input name="inputFile4Base64" id="inputFile4Base64" type="hidden" value="">
                                    <br>
                                    <output id="list4"></output>
                                </div>
                            </div>
                            <div class="form-group">
                                <input type="button" value="Add" class="btn btn-primary" id="addButtonPayments" onclick="addPayments();">&nbsp;&nbsp;&nbsp;                                                                                                                                             
                            </div>  
                            <div class="form-group" style="width: 100%; overflow: auto;">    
                                <br>
                                <input name="countPayments" id="countPayments" type="hidden" value="0">
                                <table id="tablePayments" class="table table-responsive-sm table-bordered table-hover table-sm" style="display: table; width: 100%; font-size: 14px;">
                                    <tr align="center" style="background-color: #f0f3f5;">
                                        <th align="center">Way to pay</th>                            
                                        <th align="center">Amount</th>                            
                                        <th align="center">Issuing bank</th>                            
                                        <th align="center">Receiving bank</th>                            
                                        <th align="center">Operation number</th>                            
                                        <th align="center">Action</th>
                                    </tr>
                                    {% set acumAmountPayments = 0 %}    
                                    {% set statusRegister = "" %} 
                                    {% for paymentsMc in medicalcenter.payments %}

                                        {% if paymentsMc.status == 1 %}
                                            {% set acumAmountPayments = acumAmountPayments + paymentsMc.amount %}   
                                            {% set statusRegister = '1' %} 
                                            <tr align="center" id="trPayments_{{ loop.index-1 }}">
                                            {% else %}
                                            <tr align="center" id="trPayments_{{ loop.index-1 }}" style="display: none">
                                                {% set statusRegister = '2' %} 
                                            {% endif %}
                                            <td align="center">{{ paymentsMc.waytopay }}
                                                <input type="hidden" id="waytopay_{{loop.index-1}}" name="waytopay_{{loop.index-1}}"  value="{{paymentsMc.waytopay}}" />
                                                <input type="hidden" id="daystopay_{{loop.index-1}}" name="daystopay_{{loop.index-1}}"  value="{{paymentsMc.daystopay}}" />
                                                <input type="hidden" id="amount_{{loop.index-1}}" name="amount_{{loop.index-1}}"  value="{{paymentsMc.amount}}" />
                                                <input type="hidden" id="issuingbank_{{loop.index-1}}" name="issuingbank_{{loop.index-1}}"  value="{{paymentsMc.issuingbank}}" />
                                                <input type="hidden" id="receivingbank_{{loop.index-1}}" name="receivingbank_{{loop.index-1}}"  value="{{paymentsMc.receivingbank}}" />
                                                <input type="hidden" id="cardholder_{{loop.index-1}}" name="cardholder_{{loop.index-1}}"  value="{{paymentsMc.cardholder}}" />
                                                <input type="hidden" id="cardnumber_{{loop.index-1}}" name="cardnumber_{{loop.index-1}}"  value="{{paymentsMc.cardnumber}}" />
                                                <input type="hidden" id="expiration_{{loop.index-1}}" name="expiration_{{loop.index-1}}"  value="{{paymentsMc.expiration}}" />
                                                <input type="hidden" id="cvv_{{loop.index-1}}" name="cvv_{{loop.index-1}}"  value="{{paymentsMc.cvv}}" />
                                                <input type="hidden" id="operationnumber_{{loop.index-1}}" name="operationnumber_{{loop.index-1}}"  value="{{paymentsMc.operationnumber}}" />
                                                <input type="hidden"  id="files4_{{loop.index-1}}" name="files4_{{loop.index-1}}"  value="{{paymentsMc.files4}}" />
                                                <input type="hidden"  id="statusRegisterPayment_{{loop.index-1}}" name="statusRegisterPayment_{{loop.index-1}}"  value="{{statusRegister}}" />
                                            </td>                            
                                            <td align="center">{{ paymentsMc.amount|number_format(2, '.', ',') }} {{ globalCurrentSymbol }}</td>
                                            <td align="center">{{ paymentsMc.issuingbank }}</td>
                                            <td align="center">{{ paymentsMc.receivingbank }}</td>
                                            <td align="center">{{ paymentsMc.operationnumber }}</td>
                                            <td align="center"><a title="Delete" id="" onclick="loadDeleteModalEdit('trPayments_', '{{ loop.index-1 }}', '{{ paymentsMc.amount }}', '{{ medicalcenter.id }}', 2);" class="" style=""><img src="{{ asset('img/delete.png') }}" alt="Delete" width="18px" height="18px"/></a></td>             
                                        </tr>                                
                                    {% endfor %}
                                </table>                        
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6"></div>
                                <div class="form-group col-sm-6">
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"><b>Remaining:</b></span>
                                        </div>
                                        <input readonly="" name="remaining" id="remaining" type="hidden" value="0" >
                                        <input type="text" name="remainingShow" id="remainingShow" class="form-control" value="0">
                                        <div class="input-group-append">
                                            <span class="input-group-text" id="labelCurrenRemaining">{{ globalCurrentSymbol }}</span>
                                        </div>
                                    </div>
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"><b>Total:</b></span>
                                        </div>
                                        <input readonly="" name="total" id="total" type="hidden" value="{{ acumAmountPayments }}" >
                                        <input type="text" name="totalShow" id="totalShow" class="form-control" value="{{ acumAmountPayments|number_format(2, '.', ',') }}">
                                        <div class="input-group-append">
                                            <span class="input-group-text" id="labelCurrentTotalPay">{{ globalCurrentSymbol }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="form-group">       
                            <input type="button" value="Back" class="btn btn-primary" id="buttonback1" onclick="back();">&nbsp;&nbsp;&nbsp;                       
                            <input type="submit" value="Save" class="btn btn-primary" id="saveone" onclick="">&nbsp;&nbsp;&nbsp;
                            <a class="btn btn-primary" style="color: #ffffff" href="{{ path('medical_center_details', { 'id': medicalcenter.id }) }}">Return</a>
                        </div>
                    </div>    
                    {#/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////#}
                    <div id="myModalLicense" class="mascara" style="">
                        <div class="contenido" style="">
                            <div class="form-group" style="" id="divLicenses">     
                                <span class="close">&times;</span>
                            </div>
                            <div class="form-group" id="divButton">
                                <input type="button" value="Add" class="btn btn-primary" id="addButtonLicenses" onclick="agregarLicenses();">&nbsp;&nbsp;&nbsp;                                                        
                            </div>   
                        </div>
                    </div>
                    <div id="modalUserFront" class="mascara">
                        <div class="contenido" style="">
                            <span class="close_" onclick="$('#modalUserFront').hide();">&times;</span><br>
                            <div id="emailUsersFront"></div>

                        </div>
                    </div>
                    <div id="deleteModal" class="mascaraDelete">
                        <div class="contenidoDelete" style="">
                            <span class="close" onclick="$('#deleteModal').hide();">&times;</span><br><br>
                            <div id=""  align="center">
                                <div align="center" id="" style=""><h5 style="background-color: #f0f3f5; align-items: center">¿Sure you want to delete the record?</h5></div>
                                <br>
                                <button type="button" id="buttonAccept" class="btn btn-primary">Accept</button>
                                <button type="button" id="buttonCancel" class="btn btn-secondary" onclick="$('#deleteModal').hide();">Cancel</button>
                            </div>
                        </div>
                    </div>
                    <div id="deleteLicenseModal" class="mascaraDelete">
                        <div class="contenidoDelete" style="">
                            <span class="close" onclick="$('#deleteLicenseModal').hide();">&times;</span><br><br>
                            <div id=""  align="center">
                                <div align="center" id="" style=""><h5 style="background-color: #f0f3f5; align-items: center">¡Before removing the license you must eliminate payments from it!</h5></div>
                                <br>
                                <button type="button" id="buttonCancel" class="btn btn-primary" onclick="$('#deleteLicenseModal').hide();">Accept</button>
                            </div>
                        </div>
                    </div>
                    {#////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////#}   
                </div>

            </form>    
        </div>
    </div>

    <style type="text/css">      


    </style> 

    <script type="text/javascript">
        $(document).ready(function () {
            setTimeout(function () {
                $("#timeZ").val($("#timeZone").val());
            }, 1000);

            $('#myTab a[href="#medicalCenter"]').tab('show');
            loadAjax('country', 'div-province', 1);
            loadAjax('country', 'div-province', 20, "{{ medicalcenter.provinceid }}");
            loadAjax2('country', 'div-licenses', 3);
            loadAjax('country', 'divWayToPay', 5);
            loadAjax('country', 'divIssuingBank', 6);
            loadAjax('country', 'divReceivingBank', 7);

            verificarEmail("{{emailMc}}");

            $(".select-type").chosen({
                placeholder_text_single: "Select the type medical center"
            });

            $(".select-country").chosen({
                placeholder_text_single: "Select the country",
                width: "100%"
            });

            $(".select-province").chosen({
                placeholder_text_single: "Select the province"
            });

            $(".select-licenses").chosen({
                placeholder_text_single: "Select the license"
            });

            $(".select-waytopay").chosen({
                placeholder_text_single: "Select the way to pay",
                width: "100%"
            });

            $(".select-issuingbank").chosen({
                placeholder_text_single: "Select the issuing bank",
                width: "100%"
            });

            $(".select-receivingbank").chosen({
                placeholder_text_single: "Select the receiving bank",
                width: "100%"
            });

            $(".select-paymenttype").chosen({
                placeholder_text_single: "Select the payment type",
                width: "100%"
            });

            $('#expiration').mask("99/99");
            $('#cvv').mask("9999");
            $('#daystopay').mask("99999");
            $('#amount').mask('000000000.00', {reverse: true});

            var myModalLicense = document.getElementById('myModalLicense');
            var modalUserFront = document.getElementById('modalUserFront');

            window.onclick = function (event) {
                if (event.target === myModalLicense) {

                    myModalLicense.style.display = "none";

                } else if (event.target === modalUserFront) {

                    modalUserFront.style.display = "none";

                }
            }

            $("#countPayments").val("{{ countPaymenst }}");
            $("#countLicenses").val("{{ countLicensesMc }}");

            var acumAmount = parseFloat("{{ acumAmount }}");
            var acumAmountPayments = parseFloat("{{ acumAmountPayments }}");
            var remainingFinal = acumAmount - acumAmountPayments;
            $("#remaining").val(remainingFinal);

            $("#saveone").click(function () {
                $(".error").remove();

        {#var phonevalid = $("#phone").val();
        var phonesplit = phonevalid.split(",");
        var failphone = false;
        //Recorro la lista de los correos
        for (var i in phonesplit) {
            /*Verifico que sea una dirección de correo correcta, es la misma
             expresión regular que usa esta librería para la regla email */
            if (/[^0-9\-\+]/.test(phonesplit[i].trim()) !== false) {
                //Si falla la verificación pongo a true esta variable y salgo del ciclo
                failphone = true;
                break;
            }
        }

        var phonevalid = $("#telephonecontact1").val();
        var phonesplit = phonevalid.split(",");
        var failphonecontac1 = false;
        //Recorro la lista de los correos
        for (var i in phonesplit) {
            /*Verifico que sea una dirección de correo correcta, es la misma
             expresión regular que usa esta librería para la regla email */
            if (/[^0-9\-\+]/.test(phonesplit[i].trim()) !== false) {
                //Si falla la verificación pongo a true esta variable y salgo del ciclo
                failphonecontac1 = true;
                break;
            }
        }#}

                    var regex = /[\w-\.]{2,}@([\w-]{2,}\.)*([\w-]{2,}\.)[\w-]{2,4}/;

                    if ($("#country").val() === "") {
                                    $("#country_chosen").focus().after("<span class='error' style='color:#FF0000;'>Select the country</span>");
                                    return false;
                            } else if ($("#province").val() === "") {
                                    $("#province_chosen").focus().after("<span class='error' style='color:#FF0000;'>Select the province</span>");
                                    return false;            
                            } else if ($("#name").val() === "") {
                                    $("#name").focus().after("<span class='error' style='color:#FF0000;'>Enter the name</span>");
                                    return false;                
                            } else if ($("#code").val() === "") {
                                    $("#code").focus().after("<span class='error' style='color:#FF0000;'>Enter the code</span>");
                                    return false;                
                            } {#else if ($("#typemedicalcenter").val() === "") {
                        $("#typemedicalcenter").focus().after("<span class='error' style='color:#FF0000;'>Select the type medical center</span>");
                        return false;                
                } else if ($("#address").val() === "") {
                        $("#address").focus().after("<span class='error' style='color:#FF0000;'>Enter the address</span>");
                        return false;                
                } else if ($("#phone").val() === "") {
                        $("#phone").focus().after("<span class='error' style='color:#FF0000;'>Enter the phone</span>");
                        return false;                
                } #}else if ($("#master").val() === "") {
                                    $("#master").focus().after("<span class='error' style='color:#FF0000;'>Enter the master email</span>");
                                    return false;                
                            } else if (!regex.test($('#master').val().trim())) {
                                    $("#master").focus().after("<span class='error' style='color:#FF0000;'>Wrong email format</span>");
                                    return false;                
                    } {#else if ($("#contac1").val() === "") {
                        $("#contac1").focus().after("<span class='error' style='color:#FF0000;'>Enter the contac1</span>");
                        return false;                
                } else if ($("#telephonecontact1").val() === "") {
                        $("#telephonecontact1").focus().after("<span class='error' style='color:#FF0000;'>Enter the telephone contact 1</span>");
                        return false;                
                } else if (failphone === true) {
            $("#phone").focus().after("<span class='error' style='color:#FF0000;'>Wrong phone format</span>");
            return false;
        } else if (failphonecontac1 === true) {
            $("#telephonecontact1").focus().after("<span class='error' style='color:#FF0000;'>Wrong phone contac 1 format</span>");
            return false;
        } #}else if ($("#countLicenses").val() === "0") {
                        alert("You must enter the license");
                                    return false;                
                            } else if ($("#countPayments").val() === "0") {
                        alert("You must enter the license payment");
                                    return false;                
                            }

                    $("#country, #province, #name, #code, #master").keyup(function () {
                                if ($(this).val() !== "") {
                                        $(".error").fadeOut();
                                        return false;
                                }
                    });
                });
            });
            function next() {
                $(".error").remove();

        {#var phonevalid = $("#phone").val();
        var phonesplit = phonevalid.split(",");
        var failphone = false;
        //Recorro la lista de los correos
        for (var i in phonesplit) {
            /*Verifico que sea una dirección de correo correcta, es la misma
             expresión regular que usa esta librería para la regla email */
            if (/[^0-9\-\+]/.test(phonesplit[i].trim()) !== false) {
                //Si falla la verificación pongo a true esta variable y salgo del ciclo
                failphone = true;
                break;
            }
        }

        var phonevalid = $("#telephonecontact1").val();
        var phonesplit = phonevalid.split(",");
        var failphonecontac1 = false;
        //Recorro la lista de los correos
        for (var i in phonesplit) {
            /*Verifico que sea una dirección de correo correcta, es la misma
             expresión regular que usa esta librería para la regla email */
            if (/[^0-9\-\+]/.test(phonesplit[i].trim()) !== false) {
                //Si falla la verificación pongo a true esta variable y salgo del ciclo
                failphonecontac1 = true;
                break;
            }
        }
#}
        var regex = /[\w-\.]{2,}@([\w-]{2,}\.)*([\w-]{2,}\.)[\w-]{2,4}/;

        if ($("#country").val() === "") {
                        $("#country_chosen").focus().after("<span class='error' style='color:#FF0000;'>Select the country</span>");
                        return false;
                } else if ($("#province").val() === "") {
                        $("#province_chosen").focus().after("<span class='error' style='color:#FF0000;'>Select the province</span>");
                        return false;            
                } else if ($("#name").val() === "") {
                        $("#name").focus().after("<span class='error' style='color:#FF0000;'>Enter the name</span>");
                        return false;                
                } else if ($("#code").val() === "") {
                        $("#code").focus().after("<span class='error' style='color:#FF0000;'>Enter the code</span>");
                        return false;                
                } {#else if ($("#typemedicalcenter").val() === "") {
                        $("#typemedicalcenter").focus().after("<span class='error' style='color:#FF0000;'>Select the type medical center</span>");
                        return false;                
                } else if ($("#address").val() === "") {
                        $("#address").focus().after("<span class='error' style='color:#FF0000;'>Enter the address</span>");
                        return false;                
                } else if ($("#phone").val() === "") {
                        $("#phone").focus().after("<span class='error' style='color:#FF0000;'>Enter the phone</span>");
                        return false;                
                } #}else if ($("#master").val() === "") {
                        $("#master").focus().after("<span class='error' style='color:#FF0000;'>Enter the master email</span>");
                        return false;                
                } else if (!regex.test($('#master').val().trim())) {
                        $("#master").focus().after("<span class='error' style='color:#FF0000;'>Wrong email format</span>");
                        return false;                
        } else if ($("#validateEmaiText").val() === "1") {
            loadInfoEmailUsersFront();
                    return false;                
                }{#else if ($("#contac1").val() === "") {
                        $("#contac1").focus().after("<span class='error' style='color:#FF0000;'>Enter the contac1</span>");
                        return false;                
                } else if ($("#telephonecontact1").val() === "") {
                        $("#telephonecontact1").focus().after("<span class='error' style='color:#FF0000;'>Enter the telephone contact 1</span>");
                        return false;                
                } else if (failphone === true) {
            $("#phone").focus().after("<span class='error' style='color:#FF0000;'>Wrong phone format</span>");
            return false;
        } else if (failphonecontac1 === true) {
            $("#telephonecontact1").focus().after("<span class='error' style='color:#FF0000;'>Wrong phone contac 1 format</span>");
            return false;
        }#}

        $("#country, #province, #name, #code, #master").keyup(function () {
                    if ($(this).val() !== "") {
                            $(".error").fadeOut();
                            return false;
                    }
        });
        $("#hlicense").removeClass("disabled");
        $('#myTab a[href="#licenseLi"]').tab('show');
    }


    function back() {
        $('#myTab a[href="#medicalCenter"]').tab('show');
    }

    function validarTagsEmails() {
        var emails = $("#email").val();
        var emailssplit = emails.split(",");
        var fail = false;
        //Recorro la lista de los correos
        for (var i in emailssplit) {
            /*Verifico que sea una dirección de correo correcta, es la misma
             expresión regular que usa esta librería para la regla email */
            if (/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(emailssplit[i].trim()) === false) {
                //Si falla la verificación pongo a true esta variable y salgo del ciclo
                fail = true;
                break;
            }
        }
        if (fail == true)
        {
            alert('nooo');
            $("#email").focus();
            return false;
        }
    }

    function validarTagsPhone() {
        var phone = $("#phone").val();
        var phonesplit = phone.split(",");
        var fail = false;
        //Recorro la lista de los correos
        for (var i in phonesplit) {
            /*Verifico que sea una dirección de correo correcta, es la misma
             expresión regular que usa esta librería para la regla email */
            if (/[^0-9\-\+]/.test(phonesplit[i].trim()) !== false) {
                //Si falla la verificación pongo a true esta variable y salgo del ciclo
                fail = true;
                break;
            }
        }
        if (fail == true)
        {
            alert('nooo');
            $("#phone").focus();
            return false;
        }
    }

    function loadAjax(valor, div, opcion, valoredit) {
        var valor_id = $("#" + valor).val();
        var valor_country = $("#country").val();
        if (valor_id !== "")
        {
            $.ajax({
                type: 'POST',
                url: "{{ path('ajax') }}",
                data: {valor_id: valor_id, opcion: opcion, valor_country: valor_country, valoredit: valoredit},
                success: function (html) {
                    $("#" + div).html(html);
                }
            });
        }
    }

    function loadAjax2(valor, div, opcion, valoredit) {
        var valor_id = $("#" + valor).val();
        if (valor_id !== "")
        {
            $.ajax({
                type: 'POST',
                url: "{{ path('ajax_') }}",
                data: {valor_id: valor_id, opcion: opcion, valoredit: valoredit},
                success: function (html) {
                    $("#" + div).html(html);
                }
            });
        }
    }

    function trueBranches() {
        $("#tabs").tabs("enable", 1);
        $("#tabs").tabs("disable", 2);
        //$("#buttonnext").prop("disabled", false);
        //$("#saveone").prop("disabled", true);
    }

    function falseBranches() {
        $("#tabs").tabs("disable", 1);
        $("#tabs").tabs("enable", 2);
        //$("#saveone").prop("disabled", false);
        //$("#buttonnext").prop("disabled", true);
    }

    function loadInfoLicense() {
        var valor_id = $("#license").val();
        if (valor_id !== "")
        {
            $("#span0").text("");
            var modal = document.getElementById('myModalLicense');
            modal.style.display = "block";
        }
    }

    function loadInfoEmailUsersFront()
    {

        var modal = document.getElementById('modalUserFront');
        modal.style.display = "block";

    }


    function agregarLicenses() {

        $("#span0").text("");

        var license = $("#license").val();
        var inputLicense = $('#inputLicense').val();
        var inputUsersQuantity = $('#inputUsersQuantity').val();
        var inputNumberClients = $('#inputNumberClients').val();
        var inputNumberExams = $('#inputNumberExams').val();
        var inputDurationTime = $('#inputDurationTime').val();
        var inputAmount = $('#inputAmount').val();
        var inputAmountFormat = number_format(inputAmount, 2);
        var inputCurrentSymbol = $('#inputCurrentSymbol').val();
        var i = 0; //contador para asignar id al boton que borrara la fila
        var counter = $("#countLicenses").val();
        var acumAmount = $("#amountTotal").val();
        var amount = 0;

        if (counter !== "0") {
            for (i = 0; i <= counter; i++) {
                if (($("#licenseId_" + i).val() === license) && ($("#trlicense_" + i).is(":visible"))) {
                    $("#divButton").focus().after("<div align='center' id = 'span0' class='error' style='color:#FF0000; text-align: center;'>This license is already in the table</div>");
                    $("#fields").val("");
                    return false;
                }
            }
        }

        counter = $("#countLicenses").val();
        acumAmount = $("#amountTotal").val();

        $("#tablelicenses").show();
        var fila = '<tr align="center" id="trlicense_' + counter + '">\n\
                                <td align="center">' + inputLicense + '</td>\n\
                                <input type="hidden" id="licenseId_' + counter + '" name="licenseId_' + counter + '"  value="' + document.getElementById("licenseid").value + '" />\n\
                                <input type="hidden" id="durationTime_' + counter + '" name="durationTime_' + counter + '"  value="' + document.getElementById("inputDurationTime").value + '" />\n\
                                <input type="hidden" id="statusRegisterLicense_' + counter + '" name="statusRegisterLicense_' + counter + '"  value="1" />\n\
                                <td align="center">' + inputUsersQuantity + '</td>\n\
                                <td align="center">' + inputNumberClients + '</td>\n\
                                <td align="center">' + inputNumberExams + '</td>\n\
                                <td align="center">' + inputDurationTime + '</td>\n\
                                <td align="center">' + inputAmountFormat + ' ' + inputCurrentSymbol + '</td>\n\
                                <td><a title="Delete" id="' + counter + '" onclick="loadDeleteModal(\'trlicense_\', ' + counter + ', ' + inputAmount + ', 1);" class="" style=""><img src="{{ asset('img/delete.png') }}" alt="Delete" width="18px" height="18px"/></a></td>\n\
                            </tr>';
        counter++;
        amount = parseFloat(acumAmount) + parseFloat(inputAmount);
        var amountFormat = number_format(amount, 2);
        var remaining = parseFloat(acumAmount) + parseFloat(inputAmount) - parseFloat($("#total").val());
        var remainingFormat = number_format(remaining, 2);
        $("#countLicenses").val(counter);
        $("#amountTotal").val(amount);
        $("#amountTotalShow").val(amountFormat);
        $("#remaining").val(remaining);
        $("#remainingShow").val(remainingFormat);
        //$("#amountTotal").val(new Intl.NumberFormat("es-PE").format(amount));

        //$("#total").val(amount);
        $('#tablelicenses tr:first').after(fila);
        var nFilas = $("#tablelicenses tr").length;
        $('#license').val("").trigger('chosen:updated');
        $('#myModalLicense').hide();
        $('#divAmount').show();
        $('#labelPayments').show();
        $('#payment').show();
        $('#labelLicense').show();
        $('#labelAmountCurrentSymbol').text(inputCurrentSymbol);
        $('#labelAmountCurrentSymbol').css("font-weight", "bold");

    }

    function restaLicenses(amountCelda) {
        var valor = $("#countLicenses").val();
        var valor1 = 1;
        var resultado = valor - valor1;
        $("#countLicenses").val(resultado);

        var valorAmountCelda = amountCelda;
        var valorAmount = $("#amountTotal").val();
        var resultadoAmount = valorAmount - valorAmountCelda;
        var amountFormat = number_format(resultadoAmount, 2);

        $("#amountTotal").val(resultadoAmount);
        $("#amountTotalShow").val(amountFormat);

        if (resultado === 0)
        {
            $("#tablelicenses").hide();
            $("#divAmount").hide();
            $('#labelPayments').hide();
            $('#payment').hide();
            $('#labelLicense').hide();
        }
    }

    function restaLicensesEdit(amountCelda) {
        var acumPayment = 0;
        for (i = 0; i <= $("#countPayments").val(); i++) {
            if ($("#trPayments_" + i).is(":visible")) {
                acumPayment++;
            }
        }
        if (acumPayment === 0) {

            var valorAmountCelda = amountCelda;
            var valorAmount = $("#amountTotal").val();
            var resultadoAmount = valorAmount - valorAmountCelda;
            var amountFormat = number_format(resultadoAmount, 2);
            $("#amountTotal").val(resultadoAmount);
            $("#amountTotalShow").val(amountFormat);
            $("#remaining").val(resultadoAmount);
            $("#remainingShow").val(amountFormat);
        } else {
        }
    }

    function paymentType() {
        if ($("#paymenttype").val() === "partial")
        {
            $("#divDaystopay").show();
            $("#amount").val("0");
            $("#amount").prop("disabled", false);
        } else
        {
            $("#divDaystopay").hide();
            $("#daystopay").val("0");
            var amountTotal = $("#amountTotal").val();
            $("#amount").val(amountTotal);
            $("#amount").prop("disabled", true);
            var amount = parseFloat($("#amountTotal").val()) - parseFloat($("#total").val());
            $("#amount").val(amount);
        }

    }

    function wayToPayOperation() {
        if (($("#waytopay").val() === "") || ($("#waytopay").val() === "EFECTIVO"))
        {
            $("#divInfoTarjetas").hide();
            $("#divNumCheck").hide();
            $("#divProofTransfer").hide();

            $("#cardholder").val("");
            $("#cardnumber").val("");
            $("#expiration").val("");
            $("#cvv").val("");
            $("#operationnumber").val("");
            $("#files4").val("");
            $("#inputFile4Base64").val("");
            $("#list4").html("");

            $("#receivingbank").attr('disabled', true).trigger("chosen:updated");
            $("#issuingbank").attr('disabled', true).trigger("chosen:updated");
            $("#operationnumber").prop("disabled", true);

        } else if (($("#waytopay").val() === "TDD") || ($("#waytopay").val() === "TDC"))
        {
            $("#divInfoTarjetas").show();
            $("#divNumCheck").hide();
            $("#divProofTransfer").hide();

            $("#operationnumber").val("");
            $("#files4").val("");
            $("#inputFile4Base64").val("");
            $("#list4").html("");

            $("#receivingbank").attr('disabled', false).trigger("chosen:updated");
            $("#issuingbank").attr('disabled', false).trigger("chosen:updated");
            $("#operationnumber").prop("disabled", false);

        } else if ($("#waytopay").val() === "CHEQUE")
        {
            $("#divInfoTarjetas").hide();
            $("#divNumCheck").show();
            $("#divProofTransfer").hide();

            $("#cardholder").val("");
            $("#cardnumber").val("");
            $("#expiration").val("");
            $("#cvv").val("");
            $("#files4").val("");
            $("#inputFile4Base64").val("");
            $("#list4").html("");

            $("#receivingbank").attr('disabled', false).trigger("chosen:updated");
            $("#issuingbank").attr('disabled', false).trigger("chosen:updated");
            $("#operationnumber").prop("disabled", false);

        } else if (($("#waytopay").val() === "TRANSFERENCIA") || ($("#waytopay").val() === "DEPOSITO"))
        {
            $("#divInfoTarjetas").hide();
            $("#divNumCheck").hide();
            $("#divProofTransfer").show();

            $("#cardholder").val("");
            $("#cardnumber").val("");
            $("#expiration").val("");
            $("#cvv").val("");
            $("#operationnumber").val("");

            $("#receivingbank").attr('disabled', false).trigger("chosen:updated");
            $("#issuingbank").attr('disabled', false).trigger("chosen:updated");
            $("#operationnumber").prop("disabled", false);
        }
    }

    function invento() {
        var formData = new FormData($("#formid")[0]);

        $.ajax({
            type: 'POST',
            url: "{{ path('images') }}",
            data: formData,
            contentType: false,
            processData: false,
            success: function (html) {
                $('#tablePayments tr:first').after(html);
            }
        });
    }

    function addPayments() {

        $("#span1").text("");
        $("#span2").text("");
        $("#span3").text("");
        $("#span4").text("");
        $("#span5").text("");
        $("#span6").text("");
        $("#span7").text("");
        $("#span8").text("");
        $("#span9").text("");
        $("#span10").text("");
        $("#span11").text("");
        $("#span12").text("");
        $("#span13").text("");

        var simboloMoneda = $("#labelCurrentTotalPay").text();
        var waytopay = $("#waytopay").val();
        var waytopay_name = $("#waytopay").children(':selected').text();
        var paymenttype = $("#paymenttype").val();
        var daystopay = $('#daystopay').val();
        var amount = $('#amount').val();
        var amountFormat = number_format(amount, 2);
        var issuingbank = $('#issuingbank').val();
        var receivingbank = $('#receivingbank').val();
        var cardholder = $('#cardholder').val();
        var cardnumber = $('#cardnumber').val();
        var expiration = $('#expiration').val();
        var cvv = $('#cvv').val();
        var files4 = $('#inputFile4Base64').val();
        var operationnumber = $('#operationnumber').val();
        var amountTotal = parseFloat($("#amountTotal").val());
        var total = $("#total").val();
        var remaining;
        var sum_amount_total;
        var i = 0; //contador para asignar id al boton que borrara la fila
        var counter = $("#countPayments").val();

        if (waytopay === "")
        {
            $("#waytopay_chosen").focus().after("<span id='span1' class='error' style='color:#FF0000;'>Select the payment method</span>");
            return false;
        }

        if (paymenttype === "")
        {
            $("#paymenttype_chosen").focus().after("<span id='span2' class='error' style='color:#FF0000;'>Select the payment type</span>");
            return false;
        }

        if (paymenttype === "partial")
        {
            if (daystopay === "0")
            {
                $("#daystopay").focus().after("<span id='span3' class='error' style='color:#FF0000;'>Enter the days to finish paying</span>");
                return false;
            }
        }

        if (amount === "")
        {
            $("#amount").focus().after("<span id='span4' class='error' style='color:#FF0000;'>Enter the amount</span>");
            return false;
        }

        if ((waytopay !== "EFECTIVO") && (issuingbank === ""))
        {
            $("#issuingbank_chosen").focus().after("<span id='span5' class='error' style='color:#FF0000;'>Select the issuing bank</span>");
            return false;
        }

        if ((waytopay !== "EFECTIVO") && (receivingbank === ""))
        {
            $("#receivingbank_chosen").focus().after("<span id='span6' class='error' style='color:#FF0000;'>Select the receiving bank</span>");
            return false;
        }

        if ((waytopay !== "EFECTIVO") && (operationnumber === ""))
        {
            $("#operationnumber").focus().after("<span id='span7' class='error' style='color:#FF0000;'>Enter the operation number</span>");
            return false;
        }

        if ((waytopay === "TDD") || (waytopay === "TDC"))
        {
            if (cardholder === "")
            {
                $("#cardholder").focus().after("<span id='span8' class='error' style='color:#FF0000;'>Enter the card holder</span>");
                return false;
            }
            if (cardnumber === "")
            {
                $("#cardnumber").focus().after("<span id='span9' class='error' style='color:#FF0000;'>Enter the card number</span>");
                return false;
            }
            if (expiration === "")
            {
                $("#expiration").focus().after("<span id='span10' class='error' style='color:#FF0000;'>Enter the expiration</span>");
                return false;
            }
            if (cvv === "")
            {
                $("#cvv").focus().after("<span id='span11' class='error' style='color:#FF0000;'>Enter the cvv</span>");
                return false;
            }
        }

        if ((waytopay === "TRANSFERENCIA") || (waytopay === "DEPOSITO"))
        {
            if (files4 === "")
            {
                $("#files4").focus().after("<span id='span12' class='error' style='color:#FF0000;'>Enter the Proof transfer</span>");
                return false;
            }
        }

        if (waytopay === "CHEQUE")
        {
            if (operationnumber === "")
            {
                $("#operationnumber").focus().after("<span id='span13' class='error' style='color:#FF0000;'>Enter the check number</span>");
                return false;
            }
        }

        if (issuingbank === "")
        {
            issuingbank = "Any";
        } else
        {
            issuingbank = $("#issuingbank").children(':selected').text();
        }

        if (receivingbank === "")
        {
            receivingbank = "Any";
        } else
        {
            receivingbank = $("#receivingbank").children(':selected').text();
        }

        sum_amount_total = parseFloat(amount) + parseFloat(total);
        remaining = amountTotal - sum_amount_total;

        if (sum_amount_total > amountTotal)
        {
            $("#amount").focus().after("<span id='span4' class='error' style='color:#FF0000;'>The amount entered will exceed the amount to be paid</span>");
            return false;
        }

        counter = $("#countPayments").val();


        $("#tablePayments").show();
        var fila = '<tr align="center" id="trPayments_' + counter + '">\n\
                        <td align="center">' + waytopay_name + '</td>\n\
                        <input type="hidden" id="waytopay_' + counter + '" name="waytopay_' + counter + '"  value="' + $("#waytopay").children(':selected').text() + '" />\n\
                        <input type="hidden" id="daystopay_' + counter + '" name="daystopay_' + counter + '"  value="' + document.getElementById("daystopay").value + '" />\n\
                        <input type="hidden" id="amount_' + counter + '" name="amount_' + counter + '"  value="' + document.getElementById("amount").value + '" />\n\
                        <input type="hidden" id="issuingbank_' + counter + '" name="issuingbank_' + counter + '"  value="' + issuingbank + '" />\n\
                        <input type="hidden" id="receivingbank_' + counter + '" name="receivingbank_' + counter + '"  value="' + receivingbank + '" />\n\
                        <input type="hidden" id="cardholder_' + counter + '" name="cardholder_' + counter + '"  value="' + document.getElementById("cardholder").value + '" />\n\
                        <input type="hidden" id="cardnumber_' + counter + '" name="cardnumber_' + counter + '"  value="' + document.getElementById("cardnumber").value + '" />\n\
                        <input type="hidden" id="expiration_' + counter + '" name="expiration_' + counter + '"  value="' + document.getElementById("expiration").value + '" />\n\
                        <input type="hidden" id="cvv_' + counter + '" name="cvv_' + counter + '"  value="' + document.getElementById("cvv").value + '" />\n\
                        <input type="hidden" id="operationnumber_' + counter + '" name="operationnumber_' + counter + '"  value="' + document.getElementById("operationnumber").value + '" />\n\
                        <input type="hidden"  id="files4_' + counter + '" name="files4_' + counter + '"  value="' + document.getElementById("inputFile4Base64").value + '" />\n\
                        <input type="hidden"  id="statusRegisterPayment_' + counter + '" name="statusRegisterPayment_' + counter + '"  value="1" />\n\
                        <td align="center">' + amount + ' ' + simboloMoneda + '</td>\n\
                        <td align="center">' + issuingbank + '</td>\n\
                        <td align="center">' + receivingbank + '</td>\n\
                        <td align="center">' + operationnumber + '</td>\n\
                        <td><a title="Delete" id="' + counter + '" onclick="loadDeleteModal(\'trPayments_\', ' + counter + ', ' + amount + ', 2);" class="" style=""><img src="{{ asset('img/delete.png') }}" alt="Delete" width="18px" height="18px"/></a></td>\n\
                    </tr>';

        counter++;
        var totalShow = number_format(sum_amount_total, 2);
        var remainingShow = number_format(remaining, 2);

        $("#total").val(sum_amount_total);
        $("#totalShow").val(totalShow);
        $("#remaining").val(remaining);
        $("#remainingShow").val(remainingShow);

        $("#countPayments").val(counter);

        $('#tablePayments tr:first').after(fila);
        var nFilas = $("#tablePayments tr").length;
        $('#waytopay').val("").trigger('chosen:updated');
        $('#paymenttype').val("").trigger('chosen:updated');
        $('#daystopay').val("0");
        $('#divDaystopay').hide();
        $('#amount').val("");
        $("#amount").prop("disabled", false);
        $('#operationnumber').val("");
        $('#files4').val("");
        $('#list4').empty();
        $('#issuingbank').val("").trigger('chosen:updated');
        $('#receivingbank').val("").trigger('chosen:updated');
        $("#divInfoTarjetas").hide();
        $("#divNumCheck").hide();
        $("#divProofTransfer").hide();
    }

    function restaPayments(amountCelda) {
        var valor = $("#countPayments").val();
        var valor1 = 1;
        var resultado = valor - valor1;
        $("#countPayments").val(resultado);

        var valorAmountCelda = amountCelda;
        var valorTotal = $("#total").val();
        var valorRemaining = $("#remaining").val();

        var totalPayments = parseFloat(valorTotal) - parseFloat(valorAmountCelda);
        var totalPaymentsFormat = number_format(totalPayments, 2);
        var restaPayments = parseFloat(valorAmountCelda) + parseFloat(valorRemaining);
        var restaPaymentsFormat = number_format(restaPayments, 2);
        $("#total").val(totalPayments);
        $("#totalShow").val(totalPaymentsFormat);
        $("#remaining").val(restaPayments);
        $("#remainingShow").val(restaPaymentsFormat);

    }

    function restaPaymentsEdit(amountCelda) {
        var valorAmountCelda = amountCelda;
        var valorTotal = $("#total").val();
        var valorRemaining = $("#remaining").val();

        var totalPayments = parseFloat(valorTotal) - parseFloat(valorAmountCelda);
        var totalPaymentsFormat = number_format(totalPayments, 2);
        var restaPayments = parseFloat(valorAmountCelda) + parseFloat(valorRemaining);
        var restaPaymentsFormat = number_format(restaPayments, 2);
        $("#total").val(totalPayments);
        $("#totalShow").val(totalPaymentsFormat);
        $("#remaining").val(restaPayments);
        $("#remainingShow").val(restaPaymentsFormat);
    }

    function addPayments_() {

        var formData = new FormData($("#formid")[0]);

        $.ajax({
            type: 'POST',
            url: "{{ path('images') }}",
            data: formData,
            contentType: false,
            processData: false,
            success: function (html) {
                $("#loadNameFile4").html(html);
            }
        });
    }

    function deleteBranchOfficess(medicalcenterid, position) {

        if (confirm("¿Be sure to eliminate the branch officess?")) {
            var opcion = 30;
            $.ajax({
                type: 'POST',
                url: "{{ path('deletebranchofficess') }}",
                data: {medicalcenterid: medicalcenterid, position: position, opcion: opcion},
                success: function (html) {
                    //$("#" + div).html(html);
                }
            });
            $("#statusRegister_" + position).val("2");
            $("#tr_" + position).hide();
        } else {
        }
    }

    function deleteLicense(medicalcenterid, position) {

        var deleteLicenseModal = document.getElementById('deleteLicenseModal');

        var acumPayment = 0;
        for (i = 0; i <= $("#countPayments").val(); i++) {
            if ($("#trPayments_" + i).is(":visible")) {
                acumPayment++;
            }
        }
        if (acumPayment === 0) {
            var opcion = 40;
            $.ajax({
                type: 'POST',
                url: "{{ path('deletelicense') }}",
                data: {medicalcenterid: medicalcenterid, position: position, opcion: opcion},
                success: function (html) {
                    //$("#" + div).html(html);
                }
            });
            $("#statusRegisterLicense_" + position).val("2");
            $("#trlicense_" + position).hide();
            deleteModal.style.display = "none";

        } else {

            deleteModal.style.display = "none";
            deleteLicenseModal.style.display = "block";
            return false;

        }

    }

    function deletePayments(medicalcenterid, position, amount) {

        var opcion = 50;
        $.ajax({
            type: 'POST',
            url: "{{ path('deletepayment') }}",
            data: {medicalcenterid: medicalcenterid, position: position, opcion: opcion},
            success: function (html) {
                //$("#" + div).html(html);
            }
        });
        $("#statusRegisterPayment_" + position).val("2");
        $("#trPayments_" + position).hide();
        restaPaymentsEdit(amount);
        deleteModal.style.display = "none";
    }

    function archivo4(evt) {
        var files = evt.target.files; // FileList object

        //Obtenemos la imagen del campo "file". 
        for (var i = 0, f; f = files[i]; i++) {
            //Solo admitimos imágenes.
            if (!f.type.match('image.*')) {
                continue;
            }

            var reader = new FileReader();

            reader.onload = (function (theFile) {
                return function (e) {
                    // Creamos la imagen.
                    document.getElementById("list4").innerHTML = ['<img style="width:280px; height:170px;" class="thumb" src="', e.target.result, '" title="', escape(theFile.name), '"/>'].join('');
                };
            })(f);

            reader.readAsDataURL(f);
        }
    }

    document.getElementById('files4').addEventListener('change', archivo4, false);

    function base64File4(element) {
        var file = element.files[0];
        var reader = new FileReader();
        reader.onloadend = function () {
            //console.log('RESULT', reader.result);
            $("#inputFile4Base64").val(reader.result);
        }
        reader.readAsDataURL(file);
    }

    function validateEmail(email) {

        var opcion = 60;
        $.ajax({
            type: 'POST',
            url: "{{ path('validateEmail') }}",
            data: {email: email, opcion: opcion},
            success: function (html) {
                $("#master").focus().after(html);
        {#                        $("#master").focus().after("<span class='error' style='color:#FF0000;'>Enter the master email</span>");#}
                    }
                });

            }

            function verificarEmail() {

                var email = $("#master").val();
                var idMedical = $("#inputMedicalCenterId").val();
                var opcion = 61;

                $.ajax({
                    type: 'POST',
                    url: "{{ path('validateEmailUserFront') }}",
                    data: {email: email, opcion: opcion, idMedical: idMedical},
                    success: function (html) {
                        $("#emailUsersFront").html(html);
                    }
                });

            }

            function insertUsersFront() {
                $("#insertFrontUser").val("1");
                $('#modalUserFront').hide();
                $("#hlicense").removeClass("disabled");
                $('#myTab a[href="#licenseLi"]').tab('show');
            }

            function loadDeleteModal(idTr, posicion, amount, opcion)
            {
                var deleteModal = document.getElementById('deleteModal');
                deleteModal.style.display = "block";

                var boton = document.getElementById("buttonAccept");
                boton.onclick = function (e) {
                    $("#" + idTr + posicion).remove();
                    deleteModal.style.display = "none";
                    if (opcion === 1)
                    {
                        restaLicenses(amount);
                    } else
                    {
                        restaPayments(amount);
                    }

                }
            }

            function loadDeleteModalEdit(idTr, posicion, amount, medicalcenterId, opcion)
            {
                var deleteModal = document.getElementById('deleteModal');
                deleteModal.style.display = "block";

                var boton = document.getElementById("buttonAccept");
                boton.onclick = function (e) {

                    if (opcion === 1)
                    {
                        deleteLicense(medicalcenterId, posicion);
                        restaLicensesEdit(amount);
                    } else
                    {
                        deletePayments(medicalcenterId, posicion, amount);
                    }

                }
            }

            function number_format(amount, decimals) {

                amount += ''; // por si pasan un numero en vez de un string
                amount = parseFloat(amount.replace(/[^0-9\.]/g, '')); // elimino cualquier cosa que no sea numero o punto

                decimals = decimals || 0; // por si la variable no fue fue pasada

                // si no es un numero o es igual a cero retorno el mismo cero
                if (isNaN(amount) || amount === 0)
                    return parseFloat(0).toFixed(decimals);

                // si es mayor o menor que cero retorno el valor formateado como numero
                amount = '' + amount.toFixed(decimals);

                var amount_parts = amount.split('.'),
                        regexp = /(\d+)(\d{3})/;

                while (regexp.test(amount_parts[0]))
                    amount_parts[0] = amount_parts[0].replace(regexp, '$1' + ',' + '$2');

                return amount_parts.join('.');
            }

    </script>  
{% endblock %}