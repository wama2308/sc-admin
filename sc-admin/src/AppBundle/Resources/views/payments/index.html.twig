{% extends '@App/base.html.twig' %}

{% block ol %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{{ path('homepage') }}">Home</a>
        </li>
        <li class="breadcrumb-item active">
            <a href="{{ path('payments_list') }}">Payments</a>
        </li>
        <li class="breadcrumb-item active"> Payment Medical Center</li>
        <!-- Breadcrumb Menu-->
        <li class="breadcrumb-menu d-md-down-none">
            {#<div class="btn-group" role="group" aria-label="Button group">
                <a class="btn" href="#">
                    <i class="icon-speech"></i>
                </a>
                <a class="btn" href="./">
                    <i class="icon-graph"></i>  Dashboard</a>
                <a class="btn" href="#">
                    <i class="icon-settings"></i>  Settings</a>
            </div>#}
        </li>
    </ol>        
{% endblock %}

{% block body %}

    <div class="card">
        <div class="card-header">
            {#            <a class="btn btn-primary" href="{{ path('country_create') }}" role="button"><i class="fas fa-plus-circle"></i> </a>&nbsp;&nbsp;&nbsp;&nbsp;          #}
            <strong>Payment Medical Center</strong>
            {#            <small>List</small>#}
        </div>        
        <div class="card-body">
            <div class="panel panel-body" id="guevo">
                <form autocomplete="off" action="" method="post" id="formid" enctype="multipart/form-data">  
                    <div class="row">
                        {#<div class="form-group col-sm-6">  
                            <input name="a" id="a" type="hidden" value="" class="form-control">                    
                        </div>#}
                        <div class="form-group col-sm-6">  

                            {#                            <input name="medicalCenter" id="medicalCenter" type="text" value="" placeholder="Search..." class="form-control" onKeyUp="loadAjax(this.value, 'divPaymentsMedicalCenter', 6);" style="">                    #}
                            {#                                                        <input name="medicalCenter" id="medicalCenter" type="text" value="" placeholder="Search..." class="form-control" onKeyUp="loadAjax(this.value, 'divPaymentsMedicalCenter', 6);" style="">                    #}

                            <div class="autocomplete" style="width:450px;">
                                <label>Medical Center</label>
                                <input class="form-control" id="myInput" type="text" name="myInput" placeholder="Search..." on />
                                <button title="Search" type="button" onclick="loadAjax($('#myInput').val(), 'divPaymentsMedicalCenter', 7);
                                        loadAjax($('#myInput').val(), 'div-licenses', 8);
                                        loadAjax($('#myInput').val(), 'divWayToPay', 9);
                                        loadAjax($('#myInput').val(), 'divIssuingBank', 10);
                                        loadAjax($('#myInput').val(), 'divInfoLicense', 12);
                                        loadAjax($('#myInput').val(), 'divReceivingBank', 11);" class="btn btn-primary" style="position:absolute;top:201%;left: 123%;margin-top: -100px;margin-left: -100px;"><i class="fas fa-search"></i></button>
                                <button title="Clean" type="button" onclick="cleanDiv();" class="btn btn-primary" style="position:absolute;top:201%;left: 133%;margin-top: -100px;margin-left: -100px;"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>                   

                </form>
                <div id="divPaymentsMedicalCenter" style="display: none">
                    {#<table id="tablePayments" class="table table-responsive-sm table-striped"> 
                        <thead> 
                            <tr> 
                                <th>Medical Center</th>    
                                <th>Status Payment</th>                            
                            </tr> 
                        </thead> 
                        <tbody> 
                            {% for medicalcenter in medicalcenter %}
                                {% if medicalcenter.paymentstatus == "Paid out" %}
                                    {% set status =  medicalcenter.paymentstatus %}             
                                    {% set class = "badge badge-success" %}   
                                {% else %}    
                                    {% set status = medicalcenter.paymentstatus %}
                                    {% set class = "badge badge-danger" %}   
                                {% endif %}                        
                                <tr> 
                                    <td><a title="View Details" class="nav-link" href="{{ path('payments_details', { 'id': medicalcenter.id }) }}">{{medicalcenter.name}}</a></td>                                                             
                                    <td><span class = "{{class}}">{{status}}</span></td>                                  
                                </tr>   

                            {% endfor %}
                        </tbody> 
                    </table>  #}
                </div>
                <div id="licenseModal" class="mascara">
                    <div class="contenido" style="">
                        <span class="close" onclick="$('#licenseModal').hide();
                                $('#license').val('').trigger('chosen:updated');">&times;</span><br><br>
                        <label>Licenses</label>
                        <div id="div-licenses">

                        </div>
                        <br>

                        <div class="form-group" style="display: none" id="divLicenses"></div>

                    </div>
                </div>
                <div id="infoLicenseModal" class="mascaraInfoLicense">
                    <div class="contenidoInfoLicense" style="">
                        <span class="close" onclick="$('#infoLicenseModal').hide();">&times;</span><br><br>
                        <div id="divInfoLicense"></div>
                    </div>
                </div>
                <div id="deleteModal" class="mascaraDelete">
                    <div class="contenidoDelete" style="">
                        <span class="close" onclick="$('#deleteModal').hide();">&times;</span><br><br>
                        <div id=""  align="center">
                            <h5>¿Sure you want to delete the record?</h5>
                            <br>
                            <button type="button" id="buttonAccept" class="btn btn-primary">Accept</button>
                            <button type="button" id="buttonCancel" class="btn btn-secondary" onclick="$('#deleteModal').hide();">Cancel</button>
                        </div>
                    </div>
                </div>
                <div id="paymentModal" class="mascaraPayments">
                    <div class="contenidoPayments" style="">
                        <span class="close" onclick="$('#paymentModal').hide();">&times;</span><br><br>
                        <div class="row">
                            <div class="form-group col-sm-6">         
                                <label>Way to pay</label>
                                <div id="divWayToPay">
                                    <select class="form-control select-waytopay" style="width: 100%" name="waytopay" id="waytopay" onchange="wayToPayOperation();">
                                        <option value="">Select...</option>                                  
                                    </select>
                                </div>
                            </div>
                            <div class="form-group col-sm-6">         
                                <label>Payment type</label>
                                <div id="divWayToPay">
                                    <select class="form-control select-paymenttype" style="width: 100%" name="paymenttype" id="paymenttype" onchange="paymentType();">
                                        <option value="">Select...</option>                                  
                                        <option value="full">Full</option>                                  
                                        <option value="partial">Partial</option>                                  
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-sm-6" id="divDaystopay" style="display: none">       
                                <label id="labelDaystopay">Days to pay</label>
                                <input name="daystopay" id="daystopay" type="text" value="0" placeholder="Days to pay" class="form-control" onkeypress="">                    
                            </div>
                            <div class="form-group col-sm-6">  
                                <label>Amount</label>
                                <input name="amount" id="amount" type="text" value="" placeholder="Amount" class="form-control" onkeypress="">                    
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-sm-6">         
                                <label>Issuing bank</label>
                                <div id="divIssuingBank">
                                    <select class="form-control select-issuingbank" style="width: 100%" name="issuingbank" id="issuingbank" onchange="">
                                        <option value="">Select...</option>                                  
                                    </select>
                                </div>
                            </div>
                            <div class="form-group col-sm-6">         
                                <label>Receiving bank</label>
                                <div id="divReceivingBank">
                                    <select class="form-control select-receivingbank" style="width: 100%" name="receivingbank" id="receivingbank" onchange="">
                                        <option value="">Select...</option>                                  
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="divInfoTarjetas" style="display: none">
                            <div class="row">
                                <div class="form-group col-sm-6">    
                                    <label>Card holder</label>
                                    <input name="cardholder" id="cardholder" type="text" value="" placeholder="Cardholder" class="form-control">    
                                </div>
                                <div class="form-group col-sm-6">    
                                    <label>Card number</label>
                                    <input name="cardnumber" id="cardnumber" type="text" value="" placeholder="Card number" class="form-control">    
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-sm-6">    
                                    <label>Expiration</label>
                                    <input name="expiration" id="expiration" type="text" value="" placeholder="Expiration" class="form-control">    
                                </div>
                                <div class="form-group col-sm-6">    
                                    <label>CVV</label>
                                    <input name="cvv" id="cvv" type="text" value="" placeholder="CVV" class="form-control">    
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-sm-6" id="divNumCheck" style="display: none">
                                <label>Operation number</label>
                                <input name="operationnumber" id="operationnumber" type="text" value="" placeholder="Operation Number" class="form-control" disabled="">                    
                            </div>
                            <div class="form-group col-sm-6" id="divProofTransfer"  style="display: none">
                                <label>Proof transfer</label>
                                <input type="file" id="files4" name="files4" onchange="base64File4(this);" class="form-control"/>
                                <input name="inputFile4Base64" id="inputFile4Base64" type="hidden" value="">
                                <br>
                                <output id="list4"></output>

                            </div>
                        </div>
                        <div class="form-group">  
                            <input type="button" value="Add" class="btn btn-primary" id="addButtonPayments" onclick="addPayments();">&nbsp;&nbsp;&nbsp;                                                                                                                                                                         
                        </div>                        
                    </div>
                </div>
                <div class="form-group">         
                    <input type="submit" value="Save" class="btn btn-primary" id="saveone" onclick="" style="display: none">&nbsp;&nbsp;&nbsp;
                    {#<a class="btn btn-primary" style="color: #ffffff" href="{{ path('payments_details', { 'id': id }) }}">Return</a>
                    <a class="btn btn-primary" style="color: #ffffff" href="{{ path('payments_list') }}">Return</a>#}
                </div>                
            </div>
        </div>
    </div>

    <style>
        * {
            box-sizing: border-box;
        }

        {#body {
            font: 16px Arial;  
        }#}

        .autocomplete {
            /*the container must be positioned relative:*/
            position: relative;
            display: inline-block;
        }

        input {
            border: 1px solid transparent;
            background-color: #f1f1f1;
            {#            padding: 10px;#}
            font-size: 16px;
        }

        input[type=text] {
            background-color: #f1f1f1;
            width: 100%;
        }

        input[type=submit] {
            background-color: DodgerBlue;
            color: #fff;
            cursor: pointer;
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            /*position the autocomplete items to be the same width as the container:*/
            top: 100%;
            left: 0;
            right: 0;
        }

        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff; 
            border-bottom: 1px solid #d4d4d4; 
        }

        .autocomplete-items div:hover {
            /*when hovering an item:*/
            background-color: #e9e9e9; 
        }

        .autocomplete-active {
            /*when navigating through the items using the arrow keys:*/
            background-color: DodgerBlue !important; 
            color: #ffffff; 
        }

        .mascara {
            display: none; 
            position: fixed; 
            z-index: 1; 
            padding-top: 100px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
            -webkit-transition: opacity 400ms ease-in;
            -moz-transition: opacity 400ms ease-in;
            transition: opacity 400ms ease-in;
            pointer-events: auto;
        }
        .mascara > div {
            width: 550px;
            height: 500px;
            top: 0%;
            position: relative;
            margin: 0% auto;
            padding: 5px 20px 13px 20px;
            border-radius: 10px;
            background: #FFFFFF;  /* fallback for old browsers */            
            transition: opacity 400ms ease-in;
        }
        .contenido {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;  
            height: auto;
            overflow-y: auto;
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.8s;
            animation-name: animatetop;
            animation-duration: 0.8s
        }
        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {top:-300px; opacity:0} 
            to {top:0; opacity:1}
        }

        @keyframes animatetop {
            from {top:-300px; opacity:0}
            to {top:0; opacity:1}
        }       

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .mascaraPayments {
            display: none; 
            position: fixed; 
            z-index: 1; 
            padding-top: 100px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
            -webkit-transition: opacity 400ms ease-in;
            -moz-transition: opacity 400ms ease-in;
            transition: opacity 400ms ease-in;
            pointer-events: auto;
        }
        .mascaraPayments > div {
            width: 900px;
            top: 0%;
            position: relative;
            margin: 0% auto;
            padding: 5px 20px 13px 20px;
            border-radius: 10px;
            background: #FFFFFF;  /* fallback for old browsers */            
            transition: opacity 400ms ease-in;
        }
        .contenidoPayments {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;  
            height: auto;
            overflow-y: auto;
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.8s;
            animation-name: animatetop;
            animation-duration: 0.8s
        }
        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {top:-300px; opacity:0} 
            to {top:0; opacity:1}
        }

        @keyframes animatetop {
            from {top:-300px; opacity:0}
            to {top:0; opacity:1}
        }  

        .mascaraInfoLicense {
            display: none; 
            position: fixed; 
            z-index: 1; 
            padding-top: 100px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
            -webkit-transition: opacity 400ms ease-in;
            -moz-transition: opacity 400ms ease-in;
            transition: opacity 400ms ease-in;
            pointer-events: auto;
        }
        .mascaraInfoLicense > div {
            width: 500px;
            height: 300px;
            top: 0%;
            position: relative;
            margin: 0% auto;
            padding: 5px 20px 13px 20px;
            border-radius: 10px;
            background: #FFFFFF;  /* fallback for old browsers */            
            transition: opacity 400ms ease-in;
        }
        .contenidoInfoLicense {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;  
            height: auto;
            overflow-y: auto;
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.8s;
            animation-name: animatetop;
            animation-duration: 0.8s
        }
        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {top:-300px; opacity:0} 
            to {top:0; opacity:1}
        }

        @keyframes animatetop {
            from {top:-300px; opacity:0}
            to {top:0; opacity:1}
        }  

        .mascaraDelete {
            display: none; 
            position: fixed; 
            z-index: 1; 
            padding-top: 100px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
            -webkit-transition: opacity 400ms ease-in;
            -moz-transition: opacity 400ms ease-in;
            transition: opacity 400ms ease-in;
            pointer-events: auto;
        }
        .mascaraDelete > div {
            width: 400px;
            height: 200px;
            top: 0%;
            position: relative;
            margin: 0% auto;
            padding: 5px 20px 13px 20px;
            border-radius: 10px;
            background: #FFFFFF;  /* fallback for old browsers */            
            transition: opacity 400ms ease-in;
        }
        .contenidoDelete {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;  
            height: auto;
            overflow-y: auto;
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.8s;
            animation-name: animatetop;
            animation-duration: 0.8s
        }
        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {top:-300px; opacity:0} 
            to {top:0; opacity:1}
        }

        @keyframes animatetop {
            from {top:-300px; opacity:0}
            to {top:0; opacity:1}
        }       

    </style>


    <script type="text/javascript">

        $(document).ready(function () {
            var licenseModal = document.getElementById('licenseModal');
            var paymentModal = document.getElementById('paymentModal');
            var infoLicenseModal = document.getElementById('infoLicenseModal');
            var deleteModal = document.getElementById('deleteModal');

            window.onclick = function (event) {
                if (event.target === licenseModal) {

                    licenseModal.style.display = "none";
                    $('#license').val("").trigger('chosen:updated');

                } else if (event.target === paymentModal) {

                    paymentModal.style.display = "none";

                } else if (event.target === infoLicenseModal) {

                    infoLicenseModal.style.display = "none";

                }
            }

            $('#expiration').mask("99/99");
            $('#cvv').mask("9999");
            $('#daystopay').mask("99999");
            $('#amount').mask('000000000.00', {reverse: true});
            $('#amountTotal').mask('000000000.00', {reverse: true});
            $('#remainingShow').mask('000,000,000.00', {reverse: true});
            $('#totalShow').mask('000,000,000.00', {reverse: true});

        {#$(".select-licenses").chosen({
            placeholder_text_single: "Select the license"
        });#}

                $(".select-waytopay").chosen({
                    placeholder_text_single: "Select the way to pay",
                    width: "100%"
                });

                $(".select-issuingbank").chosen({
                    placeholder_text_single: "Select the issuing bank",
                    width: "100%"
                });

                $(".select-receivingbank").chosen({
                    placeholder_text_single: "Select the receiving bank",
                    width: "100%"
                });

                $(".select-paymenttype").chosen({
                    placeholder_text_single: "Select the payment type",
                    width: "100%"
                });


                $("#countPayments").val(0);
                $("#countLicenses").val(0);

                $("#saveone").click(function () {
                    $(".error").remove();

                    if ($("#countLicenses").val() === "0") {
                        alert("You must enter the license");
                        return false;                

                    } else if ($("#countPayments").val() === "0") {
                        alert("You must enter the license payment");
                        return false;                
                    }

                });

                cleanInput();

            });

            function loadAjax(valor, div, opcion, valor_country)
            {
                var valor_id = valor;
                var valor_country = valor_country;
                if (valor_id !== "")
                {
                    $.ajax({
                        type: 'POST',
                        url: "{{ path('load_payments') }}",
                        data: {valor_id: valor_id, opcion: opcion, valor_country: valor_country},
                        success: function (html) {
                            if (opcion === 7) {
                                $('#divPaymentsMedicalCenter').show();
                            }
                            if (opcion === 5) {
                                $('#divLicenses').show();
                            }
                            $("#" + div).html(html);

                        }
                    });
                }
            }

            function loadPaymentModal()
            {
                var paymentModal = document.getElementById('paymentModal');
                paymentModal.style.display = "block";

            }

            function loadInfoLicenseModal()
            {
                var infoLicenseModal = document.getElementById('infoLicenseModal');
                infoLicenseModal.style.display = "block";

            }

            function cleanInput() {
                $("input[type=text]").on("keyup", function () {
                    option = false;
                    $("input[type=text]").each(function () {
                        if (!this.value) {
                            option = true;
                            $('#tablePaymentsBody').hide();
                        }
                    });
                });
            }

            function autocomplete(inp, arr) {
                /*the autocomplete function takes two arguments,
                 the text field element and an array of possible autocompleted values:*/
                var currentFocus;
                /*execute a function when someone writes in the text field:*/
                inp.addEventListener("input", function (e) {
                    var a, b, i, val = this.value;
                    /*close any already open lists of autocompleted values*/
                    closeAllLists();
                    if (!val) {
                        return false;
                    }
                    currentFocus = -1;
                    /*create a DIV element that will contain the items (values):*/
                    a = document.createElement("DIV");
                    a.setAttribute("id", this.id + "autocomplete-list");
                    a.setAttribute("class", "autocomplete-items");
                    /*append the DIV element as a child of the autocomplete container:*/
                    this.parentNode.appendChild(a);
                    /*for each item in the array...*/
                    for (i = 0; i < arr.length; i++) {
                        /*check if the item starts with the same letters as the text field value:*/
                        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                            /*create a DIV element for each matching element:*/
                            b = document.createElement("DIV");
                            /*make the matching letters bold:*/
                            b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                            b.innerHTML += arr[i].substr(val.length);
                            /*insert a input field that will hold the current array item's value:*/
                            b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                            /*execute a function when someone clicks on the item value (DIV element):*/
                            b.addEventListener("click", function (e) {
                                /*insert the value for the autocomplete text field:*/
                                inp.value = this.getElementsByTagName("input")[0].value;
                                /*close the list of autocompleted values,
                                 (or any other open lists of autocompleted values:*/
                                closeAllLists();
                            });
                            a.appendChild(b);
                        }
                    }
                });
                /*execute a function presses a key on the keyboard:*/
                inp.addEventListener("keydown", function (e) {
                    var x = document.getElementById(this.id + "autocomplete-list");
                    if (x)
                        x = x.getElementsByTagName("div");
                    if (e.keyCode == 40) {
                        /*If the arrow DOWN key is pressed,
                         increase the currentFocus variable:*/
                        currentFocus++;
                        /*and and make the current item more visible:*/
                        addActive(x);
                    } else if (e.keyCode == 38) { //up
                        /*If the arrow UP key is pressed,
                         decrease the currentFocus variable:*/
                        currentFocus--;
                        /*and and make the current item more visible:*/
                        addActive(x);
                    } else if (e.keyCode == 13) {
                        /*If the ENTER key is pressed, prevent the form from being submitted,*/
                        e.preventDefault();
                        if (currentFocus > -1) {
                            /*and simulate a click on the "active" item:*/
                            if (x)
                                x[currentFocus].click();
                        }
                    }
                });
                function addActive(x) {
                    /*a function to classify an item as "active":*/
                    if (!x)
                        return false;
                    /*start by removing the "active" class on all items:*/
                    removeActive(x);
                    if (currentFocus >= x.length)
                        currentFocus = 0;
                    if (currentFocus < 0)
                        currentFocus = (x.length - 1);
                    /*add class "autocomplete-active":*/
                    x[currentFocus].classList.add("autocomplete-active");
                }
                function removeActive(x) {
                    /*a function to remove the "active" class from all autocomplete items:*/
                    for (var i = 0; i < x.length; i++) {
                        x[i].classList.remove("autocomplete-active");
                    }
                }
                function closeAllLists(elmnt) {
                    /*close all autocomplete lists in the document,
                     except the one passed as an argument:*/
                    var x = document.getElementsByClassName("autocomplete-items");
                    for (var i = 0; i < x.length; i++) {
                        if (elmnt != x[i] && elmnt != inp) {
                            x[i].parentNode.removeChild(x[i]);
                        }
                    }
                }
                /*execute a function when someone clicks in the document:*/
                document.addEventListener("click", function (e) {
                    closeAllLists(e.target);
                });
            }

            var countries = {{ arrayMedicalCenter|json_encode|raw }};
                    autocomplete(document.getElementById("myInput"), countries);

            function cleanDiv() {
                $('#myInput').val("");
                $('#divPaymentsMedicalCenter').hide();
                $('#saveone').hide();
                $("#tablelicenses").hide();
                $("#labelLicense").hide();
                $('#divAmount').hide();
                $('#labelPayments').hide();
                $('#payment').hide();
                window.location = "{{path('payments_list')}}";

            }

            function loadInfoLicense()
            {
        {#                $('#license').val("").trigger('chosen:updated');#}
                $('#divLicenses').hide();
                var licenseModal = document.getElementById('licenseModal');
                licenseModal.style.display = "block";

            }

            function loadDeleteModal(idTr, posicion, amount, opcion)
            {
                var deleteModal = document.getElementById('deleteModal');
                deleteModal.style.display = "block";
                
                var boton = document.getElementById("buttonAccept");
                boton.onclick = function(e) {
                    $("#" + idTr + posicion).remove();
                    deleteModal.style.display = "none";
                    if(opcion === 1)
                    {
                        restaLicenses(amount);
                    }
                    else
                    {
                        restaPayments(amount);
                    }
                    
                }       
            }

            function agregarLicenses()
            {
                $("#span0").text("");

                
                var license = $("#license").val();
                var inputLicense = $('#inputLicense').val();
                var inputUsersQuantity = $('#inputUsersQuantity').val();
                var inputNumberClients = $('#inputNumberClients').val();
                var inputNumberExams = $('#inputNumberExams').val();
                var inputDurationTime = $('#inputDurationTime').val();
                var inputAmount = $('#inputAmount').val();
                var inputAmountFormat = number_format(inputAmount, 2);
                var inputCurrentSymbol = $('#inputCurrentSymbol').val();
                var inputNuevaFecha = $('#inputNuevaFecha').val();
                var i = 0; //contador para asignar id al boton que borrara la fila
                var counter = $("#countLicenses").val();
                var acumAmount = $("#amountTotal").val();
                var amount = 0;

                if (counter !== "0") {
                    for (i = 0; i <= counter; i++) {
                        if ($("#licenseId_" + i).val() === license) {
        {#                            alert("This license is already in the table");#}
                            $("#tablelicenses_").focus().after("<span id = 'span0' class='error' style='color:#FF0000; text-align: center;'>This license is already in the table</span>");
                            $("#fields").val("");
                            return false;
                        }
                    }
                }

                counter = $("#countLicenses").val();
                acumAmount = $("#amountTotal").val();
                var idTr = "tr";
                $("#tablelicenses").show();
                var fila = '<tr align="center" id="trlicense_' + counter + '">\n\
            <td align="center">' + inputLicense + '</td>\n\
            <input type="hidden" id="licenseId_' + counter + '" name="licenseId_' + counter + '"  value="' + document.getElementById("licenseid").value + '" />\n\
            <input type="hidden" id="durationTime_' + counter + '" name="durationTime_' + counter + '"  value="' + document.getElementById("inputDurationTime").value + '" />\n\
            <td align="center">' + inputUsersQuantity + '</td>\n\
            <td align="center">' + inputNumberClients + '</td>\n\
            <td align="center">' + inputNumberExams + '</td>\n\
            <td align="center">' + inputDurationTime + '</td>\n\
            <td align="center">' + inputAmountFormat + ' ' + inputCurrentSymbol + '</td>\n\
            <td align="center">' + inputNuevaFecha + '</td>\n\
            <td><a title="Delete" id="' + counter + '" onclick="loadDeleteModal(\'trlicense_\', ' + counter + ', ' + inputAmount + ', 1);" class="" style=""><img src="{{ asset('img/delete.png') }}" alt="Delete" width="18px" height="18px"/></a></td>\n\
        </tr>';
                counter++;
                amount = parseFloat(acumAmount) + parseFloat(inputAmount);
                var amountFormat = number_format(amount, 2);
                $("#countLicenses").val(counter);
                $("#amountTotal").val(amount);
                $("#amountTotalShow").val(amountFormat);
                $("#remaining").val(amount);
                $("#remainingShow").val(amountFormat);
                //$("#amountTotal").val(new Intl.NumberFormat("es-PE").format(amount));

                //$("#total").val(amount);
                $('#tablelicenses tr:first').after(fila);
                var nFilas = $("#tablelicenses tr").length;
                $('#license').val("").trigger('chosen:updated');
                $('#licenseModal').hide();
                $('#divAmount').show();
                $('#labelPayments').show();
                $('#payment').show();
                $('#labelLicense').show();
                $('#labelAmountCurrentSymbol').text(inputCurrentSymbol);
                $('#labelAmountCurrentSymbol').css("font-weight", "bold");
            }

            function restaLicenses(amountCelda)
            {
                var valor = $("#countLicenses").val();
                var valor1 = 1;
                var resultado = valor - valor1;
                $("#countLicenses").val(resultado);

                var valorAmountCelda = amountCelda;
                var valorAmount = $("#amountTotal").val();
                var resultadoAmount = valorAmount - valorAmountCelda;
                var amountFormat = number_format(resultadoAmount, 2);                
                
                $("#amountTotal").val(resultadoAmount);
                $("#amountTotalShow").val(amountFormat);

                var remaining = $("#remaining").val();
                var resultRemaining = valorAmountCelda - remaining;
                var resultRemainingFormat = number_format(resultRemaining, 2);
                $("#remaining").val(resultRemaining);
                $("#remainingShow").val(resultRemainingFormat);

        

                        if (resultado === 0)
                        {
        {#$("#tablelicenses").hide();
        $("#divAmount").hide();
        $('#labelPayments').hide();
        $('#payment').hide();
        $('#labelLicense').hide();#}
                }
            }

            function wayToPayOperation()
            {
                if (($("#waytopay").val() === "") || ($("#waytopay").val() === "EFECTIVO"))
                {
                    $("#divInfoTarjetas").hide();
                    $("#divNumCheck").hide();
                    $("#divProofTransfer").hide();

                    $("#cardholder").val("");
                    $("#cardnumber").val("");
                    $("#expiration").val("");
                    $("#cvv").val("");
                    $("#operationnumber").val("");
                    $("#files4").val("");
                    $("#inputFile4Base64").val("");
                    $("#list4").html("");

                    $("#receivingbank").attr('disabled', true).trigger("chosen:updated");
                    $("#issuingbank").attr('disabled', true).trigger("chosen:updated");
                    $("#operationnumber").prop("disabled", true);

                } else if (($("#waytopay").val() === "TDD") || ($("#waytopay").val() === "TDC"))
                {
                    $("#divInfoTarjetas").show();
                    $("#divNumCheck").show();
                    $("#divProofTransfer").hide();

                    $("#operationnumber").val("");
                    $("#files4").val("");
                    $("#inputFile4Base64").val("");
                    $("#list4").html("");

                    $("#receivingbank").attr('disabled', false).trigger("chosen:updated");
                    $("#issuingbank").attr('disabled', false).trigger("chosen:updated");
                    $("#operationnumber").prop("disabled", false);

                } else if ($("#waytopay").val() === "CHEQUE")
                {
                    $("#divInfoTarjetas").hide();
                    $("#divNumCheck").show();
                    $("#divProofTransfer").hide();

                    $("#cardholder").val("");
                    $("#cardnumber").val("");
                    $("#expiration").val("");
                    $("#cvv").val("");
                    $("#files4").val("");
                    $("#inputFile4Base64").val("");
                    $("#list4").html("");
                    $("#operationnumber").val("");

                    $("#receivingbank").attr('disabled', false).trigger("chosen:updated");
                    $("#issuingbank").attr('disabled', false).trigger("chosen:updated");
                    $("#operationnumber").prop("disabled", false);

                } else if (($("#waytopay").val() === "TRANSFERENCIA") || ($("#waytopay").val() === "DEPOSITO"))
                {
                    $("#divInfoTarjetas").hide();
                    $("#divNumCheck").show();
                    $("#divProofTransfer").show();

                    $("#cardholder").val("");
                    $("#cardnumber").val("");
                    $("#expiration").val("");
                    $("#cvv").val("");
                    $("#operationnumber").val("");

                    $("#receivingbank").attr('disabled', false).trigger("chosen:updated");
                    $("#issuingbank").attr('disabled', false).trigger("chosen:updated");
                    $("#operationnumber").prop("disabled", false);
                }
            }

            function paymentType()
            {
                if ($("#paymenttype").val() === "partial")
                {
                    $("#divDaystopay").show();
                    $("#amount").val("0");
                    $("#amount").prop("disabled", false);
                } else
                {
                    $("#divDaystopay").hide();
                    $("#daystopay").val("0");
                    var amountTotal = $("#amountTotal").val();
                    $("#amount").val(amountTotal);
                    $("#amount").prop("disabled", true);
                    var amount = parseFloat($("#amountTotal").val()) - parseFloat($("#total").val());
                    $("#amount").val(amount);
                }

            }

            function archivo4(evt) {
                var files = evt.target.files;

                for (var i = 0, f; f = files[i]; i++) {

                    if (!f.type.match('image.*')) {
                        continue;
                    }

                    var reader = new FileReader();

                    reader.onload = (function (theFile) {
                        return function (e) {

                            document.getElementById("list4").innerHTML = ['<img style="width:280px; height:170px;" class="thumb" src="', e.target.result, '" title="', escape(theFile.name), '"/>'].join('');
                        };
                    })(f);

                    reader.readAsDataURL(f);
                }
            }

            document.getElementById('files4').addEventListener('change', archivo4, false);

            function base64File4(element) {
                var file = element.files[0];
                var reader = new FileReader();
                reader.onloadend = function () {

                    $("#inputFile4Base64").val(reader.result);
                }
                reader.readAsDataURL(file);
            }

            function addPayments()
            {
                $("#span1").text("");
                $("#span2").text("");
                $("#span3").text("");
                $("#span4").text("");
                $("#span5").text("");
                $("#span6").text("");
                $("#span7").text("");
                $("#span8").text("");
                $("#span9").text("");
                $("#span10").text("");
                $("#span11").text("");
                $("#span12").text("");
                $("#span13").text("");
                
                var simboloMoneda = $("#simboloMoneda").val();
                var waytopay = $("#waytopay").val();
                var waytopay_name = $("#waytopay").children(':selected').text();
                var paymenttype = $("#paymenttype").val();
                var daystopay = $('#daystopay').val();
                var amount = $('#amount').val();
                var amountFormat = number_format(amount, 2);
                var issuingbank = $('#issuingbank').val();
                var receivingbank = $('#receivingbank').val();
                var cardholder = $('#cardholder').val();
                var cardnumber = $('#cardnumber').val();
                var expiration = $('#expiration').val();
                var cvv = $('#cvv').val();
                var files4 = $('#inputFile4Base64').val();
                var operationnumber = $('#operationnumber').val();
                var amountTotal = parseFloat($("#amountTotal").val());
                var total = $("#total").val();
                var remaining;
                var sum_amount_total;
                var i = 0; //contador para asignar id al boton que borrara la fila
                var counter = $("#countPayments").val();

                if (waytopay === "")
                {
                    $("#waytopay_chosen").focus().after("<span id='span1' class='error' style='color:#FF0000;'>Select the payment method</span>");
                    return false;
                }

                if (paymenttype === "")
                {
                    $("#paymenttype_chosen").focus().after("<span id='span2' class='error' style='color:#FF0000;'>Select the payment type</span>");
                    return false;
                }

                if (paymenttype === "partial")
                {
                    if (daystopay === "0")
                    {
                        $("#daystopay").focus().after("<span id='span3' class='error' style='color:#FF0000;'>Enter the days to finish paying</span>");
                        return false;
                    }
                }

                if (amount === "")
                {
                    $("#amount").focus().after("<span id='span4' class='error' style='color:#FF0000;'>Enter the amount</span>");
                    return false;
                }

                if ((waytopay !== "EFECTIVO") && (issuingbank === ""))
                {
                    $("#issuingbank_chosen").focus().after("<span id='span5' class='error' style='color:#FF0000;'>Select the issuing bank</span>");
                    return false;
                }

                if ((waytopay !== "EFECTIVO") && (receivingbank === ""))
                {
                    $("#receivingbank_chosen").focus().after("<span id='span6' class='error' style='color:#FF0000;'>Select the receiving bank</span>");
                    return false;
                }

                if ((waytopay !== "EFECTIVO") && (operationnumber === ""))
                {
                    $("#operationnumber").focus().after("<span id='span7' class='error' style='color:#FF0000;'>Enter the operation number</span>");
                    return false;
                }

                if ((waytopay === "TDD") || (waytopay === "TDC"))
                {
                    if (cardholder === "")
                    {
                        $("#cardholder").focus().after("<span id='span8' class='error' style='color:#FF0000;'>Enter the card holder</span>");
                        return false;
                    }
                    if (cardnumber === "")
                    {
                        $("#cardnumber").focus().after("<span id='span9' class='error' style='color:#FF0000;'>Enter the card number</span>");
                        return false;
                    }
                    if (expiration === "")
                    {
                        $("#expiration").focus().after("<span id='span10' class='error' style='color:#FF0000;'>Enter the expiration</span>");
                        return false;
                    }
                    if (cvv === "")
                    {
                        $("#cvv").focus().after("<span id='span11' class='error' style='color:#FF0000;'>Enter the cvv</span>");
                        return false;
                    }
                }

                if ((waytopay === "TRANSFERENCIA") || (waytopay === "DEPOSITO"))
                {
                    if (files4 === "")
                    {
                        $("#files4").focus().after("<span id='span12' class='error' style='color:#FF0000;'>Enter the Proof transfer</span>");
                        return false;
                    }
                }

                if (waytopay === "CHEQUE")
                {
                    if (operationnumber === "")
                    {
                        $("#operationnumber").focus().after("<span id='span13' class='error' style='color:#FF0000;'>Enter the check number</span>");
                        return false;
                    }
                }

                if (issuingbank === "")
                {
                    issuingbank = "Any";
                } else
                {
                    issuingbank = $("#issuingbank").children(':selected').text();
                }

                if (receivingbank === "")
                {
                    receivingbank = "Any";
                } else
                {
                    receivingbank = $("#receivingbank").children(':selected').text();
                }

                sum_amount_total = parseFloat(amount) + parseFloat(total);
                remaining = amountTotal - sum_amount_total;

                if (sum_amount_total > amountTotal)
                {
                    $("#amount").focus().after("<span id='span4' class='error' style='color:#FF0000;'>The amount entered will exceed the amount to be paid</span>");
                    return false;
                }

                counter = $("#countPayments").val();


                $("#tablePayments").show();
                var fila = '<tr align="center" id="trPayment_' + counter + '">\n\
                    <td align="center">' + waytopay_name + '</td>\n\
                    <input type="hidden" id="waytopay_' + counter + '" name="waytopay_' + counter + '"  value="' + $("#waytopay").children(':selected').text() + '" />\n\
                    <input type="hidden" id="daystopay_' + counter + '" name="daystopay_' + counter + '"  value="' + document.getElementById("daystopay").value + '" />\n\
                    <input type="hidden" id="amount_' + counter + '" name="amount_' + counter + '"  value="' + document.getElementById("amount").value + '" />\n\
                    <input type="hidden" id="issuingbank_' + counter + '" name="issuingbank_' + counter + '"  value="' + issuingbank + '" />\n\
                    <input type="hidden" id="receivingbank_' + counter + '" name="receivingbank_' + counter + '"  value="' + receivingbank + '" />\n\
                    <input type="hidden" id="cardholder_' + counter + '" name="cardholder_' + counter + '"  value="' + document.getElementById("cardholder").value + '" />\n\
                    <input type="hidden" id="cardnumber_' + counter + '" name="cardnumber_' + counter + '"  value="' + document.getElementById("cardnumber").value + '" />\n\
                    <input type="hidden" id="expiration_' + counter + '" name="expiration_' + counter + '"  value="' + document.getElementById("expiration").value + '" />\n\
                    <input type="hidden" id="cvv_' + counter + '" name="cvv_' + counter + '"  value="' + document.getElementById("cvv").value + '" />\n\
                    <input type="hidden" id="operationnumber_' + counter + '" name="operationnumber_' + counter + '"  value="' + document.getElementById("operationnumber").value + '" />\n\
                    <input type="hidden"  id="files4_' + counter + '" name="files4_' + counter + '"  value="' + document.getElementById("inputFile4Base64").value + '" />\n\
                    <td align="center">' + amountFormat + ' ' + simboloMoneda + '</td>\n\
                    <td align="center">' + issuingbank + '</td>\n\
                    <td align="center">' + receivingbank + '</td>\n\
                    <td align="center">' + operationnumber + '</td>\n\
                    <td><a title="Delete" id="' + counter + '" onclick="loadDeleteModal(\'trPayment_\', ' + counter + ', ' + amount + ', 2);" class="" style=""><img src="{{ asset('img/delete.png') }}" alt="Delete" width="18px" height="18px"/></a></td>\n\
                </tr>';

                counter++;
                var a = number_format(sum_amount_total, 2);
                var b = number_format(remaining, 2);

                $("#total").val(sum_amount_total);
                $("#totalShow").val(a);
                $("#remaining").val(remaining);
                $("#remainingShow").val(b);

                $("#countPayments").val(counter);

                $('#tablePayments tr:first').after(fila);
                var nFilas = $("#tablePayments tr").length;
                $('#waytopay').val("").trigger('chosen:updated');
                $('#paymenttype').val("").trigger('chosen:updated');
                $('#daystopay').val("0");
                $('#divDaystopay').hide();
                $('#amount').val("");
                $("#amount").prop("disabled", false);
                $('#operationnumber').val("");
                $('#files4').val("");
                $('#list4').empty();
                $('#issuingbank').val("").trigger('chosen:updated');
                $('#receivingbank').val("").trigger('chosen:updated');
                $("#divInfoTarjetas").hide();
                $("#divNumCheck").hide();
                $("#divProofTransfer").hide();
                $("#saveone").show();
                $("#paymentModal").hide();
            }

            function restaPayments(amountCelda)
            {
                var valor = $("#countPayments").val();
                var valor1 = 1;
                var resultado = valor - valor1;
                $("#countPayments").val(resultado);

                var valorAmountCelda = amountCelda;
                var valorTotal = $("#total").val();
                var valorRemaining = $("#remaining").val();

                var totalPayments = parseFloat(valorTotal) - parseFloat(valorAmountCelda);
                var totalPaymentsFormat = number_format(totalPayments, 2);
                var restaPayments = parseFloat(valorAmountCelda) + parseFloat(valorRemaining);
                var restaPaymentsFormat = number_format(restaPayments, 2);
                $("#total").val(totalPayments);
                $("#totalShow").val(totalPaymentsFormat);
                $("#remaining").val(restaPayments);
                $("#remainingShow").val(restaPaymentsFormat);

                if (resultado === 0)
                {
                    $("#saveone").hide();
                }
            }


            function number_format(amount, decimals) {

                amount += ''; // por si pasan un numero en vez de un string
                amount = parseFloat(amount.replace(/[^0-9\.]/g, '')); // elimino cualquier cosa que no sea numero o punto

                decimals = decimals || 0; // por si la variable no fue fue pasada

                // si no es un numero o es igual a cero retorno el mismo cero
                if (isNaN(amount) || amount === 0)
                    return parseFloat(0).toFixed(decimals);

                // si es mayor o menor que cero retorno el valor formateado como numero
                amount = '' + amount.toFixed(decimals);

                var amount_parts = amount.split('.'),
                        regexp = /(\d+)(\d{3})/;

                while (regexp.test(amount_parts[0]))
                    amount_parts[0] = amount_parts[0].replace(regexp, '$1' + ',' + '$2');

                return amount_parts.join('.');
            }


    </script>  

{% endblock %}
